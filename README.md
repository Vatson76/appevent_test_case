Установка и Настройка
=====================
- **Python**
1. Установить python 3.10
2. Создать виртуальное окружение `python -m venv`
3. Установить необходимые библиотеки выполнив `pip install -r requirements.txt`


- **Базы данных**

   Для работы проекта потребуются следующие базы данных:
1. MSSQL
2. Redis

   Установить их локально на ПК или развернуть в docker контейнерах


- **Переменные окружения**

   Переменные окружения хранятся в файле **.env**, расположенному по пути **backend/main/settings** или в корне проекта. 
   Поля данного файла выглядят следующим образом

```text
MYSQL_DB=db_name
MYSQL_USER=db_user
MYSQL_PASSWORD=password
MYSQL_HOST=db_host
MYSQL_PORT=db_port

SECRET_KEY=**********************

BROKER_URL=broker_url
CREDENTIALS_FOLDER=path_to_credentials

DEBUG= 0 or 1
```


Инструкции по эксплуатации
==========================
Проект может быть запущен как в докер контейнерах `docker-compose up -d`, так и самостоятельно.

Для работы с google API необходимо предоставить данные для авторизации. 
Если приложение запущено в режиме отладки **(DEBUG=True)**. Тогда данные берутся из корня папки **/backend/credentials**.
Если же **DEBUG=False**, тогда для каждой компании данные берутся из ее папки с данными авторизации.
Поэтому у каждой компании должна быть папка **/backend/credentials/company{company_id}/**. 
В которой лежат данные авторизации конкретной компании. Вся secret_data получается 
[на этой странице](https://console.cloud.google.com/apis/api/calendar-json.googleapis.com/). 

Изначально, база данных проекта пустая, чтобы занести тестовые данные откройте файл 
**\backend\company\management\commands\populate_db_data**. Заполните информацию для каждой сущности, заменив '' на 
правильную информацию. Для залов, google_calendar_id можно оставить пустым. Тогда необходимо раскомментировать строчку(52)
с имортом залов. **ВНИМАНИЕ! чтобы импорт прошел правильно, имя зала в БД должно совпадать с именем календаря**. 
В следствии чего google_calendar_id проставятся автоматически. После всех приготовлений выполните
команду `python manage.py populate_db_data` и в базе данных появятся компании, залы и импортируются их события.

В последующем, данные будут проверяться каждые 2 минуты. При каждом обновлении будет проверяться, 
какие данные изменились за прошедшие 2 минуты и если такие изменения есть, они будут отображены в БД.

Помимо вышеописанной команды в приложении присутствуют следующие команды:
1. import_halls. Принимает аргументы **int(company_id)**. Импортирует список календарей указанной компании или 
все календари всех компаний, если не указана конкретная
2. import_events. Принимает аргументы **int(company_id)**. А также флаг **--timed**, который изначально установлен 
в **False**. Импортирует все события указанной компании или всех компаний, если не указана конкретная. 
Если флаг **--timed** установлен в **True**, тогда импортирует все события, 
которые появились или обновились после указанного времени.



